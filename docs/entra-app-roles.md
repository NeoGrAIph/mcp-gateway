# Настройка ролей приложения Azure Entra ID

Выполните следующие действия, чтобы включить роли приложения, назначить их удостоверениям и передать значение роли в определения адаптера/инструмента для авторизации.

## 1. Включение и настройка ролей при регистрации приложения
- Откройте портал Azure и перейдите к **Entra ID > Регистрации приложений**; выберите приложение, которому доверяет шлюз (например, `McpGateway`).
– Перейдите в раздел **Роли приложения** и выберите **Создать роль приложения**.
- **Отображаемое имя**: понятная метка, отображаемая на портале (например, `Adapter Reader`).
- **Разрешенный тип участника**: `Users/Groups` для людей или `Applications` для субъектов-служб.
- **Значение**: неизменяемая строка, используемая при авторизации шлюза Mcp (например, `mcp.engineer`).
– Предоставьте осмысленное описание, чтобы администраторы знали, когда его предоставить.
- Сохраните роль. Повторите эти действия для каждого логического разрешения, необходимого вашей организации; вы можете создать любой шаблон значений (например, `mcp.engineer`, `mcp.scientist`).
- **Всегда создавайте роль администратора** со значением `mcp.admin`. Это значение используется шлюзом для предоставления повышенного доступа на запись за пределами создателя ресурса.
– Убедитесь, что в разделе **Роли приложений** отображаются новые записи в таблице; это автоматически обновляет манифест приложения.

## 2. Назначьте роли удостоверениям
- При той же регистрации приложения откройте запись **Корпоративные приложения** (субъект-служба).
– Перейдите в раздел **Пользователи и группы > Добавить пользователя/группу**.
- Выберите пользователя, группу или субъекта-службы.
- Выберите желаемое значение роли приложения.
- Подтвердите задание.
- Пользователи получают роль при следующем входе в систему; приложения наследуют утверждения сразу после обновления субъекта-службы.

## 3. Укажите значение роли при создании адаптеров или инструментов
- При вызове API управления (или CLI) для создания адаптеров/инструментов заполняйте коллекцию `requiredRoles` точными строками **Value**, созданными выше.
- Пример фрагмента полезной нагрузки:
  ```json
  {
    "name": "sample-adapter",
    // ...
    "requiredRoles": ["mcp.engineer", "mcp.scientist"]
  }
  ```
- `SimplePermissionProvider` шлюза предоставляет:
- Доступ **Чтение**, если вызывающий абонент является создателем, имеет `mcp.admin` или соответствует одной из записей `requiredRoles`.
- Доступ **Запись**, если вызывающий абонент является создателем или имеет `mcp.admin`.

> Если `requiredRoles` не настроен, по умолчанию РАЗРЕШЕН ВСЕМ доступ на ЧТЕНИЕ.
